(()=>{var u=class O{constructor(t,s){this.x=t,this.y=s}floor(){return new O(Math.floor(this.x),Math.floor(this.y))}add(t,s){return new O(this.x+t,this.y+s)}},r=class{constructor(t,s,e,i){this.x=t,this.y=s,this.w=e,this.h=i}intersects(t){return this.contains(new u(t.x,t.y))||this.contains(new u(t.x+t.w,t.y))||this.contains(new u(t.x,t.y+t.h))||this.contains(new u(t.x+t.w,t.y+t.h))||t.contains(new u(this.x,this.y))||t.contains(new u(this.x+this.w,this.y))||t.contains(new u(this.x,this.y+this.h))||t.contains(new u(this.x+this.w,this.y+this.h))}contains(t){return t.x>=this.x&&t.x<=this.x+this.w&&t.y>=this.y&&t.y<=this.y+this.h}},t=class{constructor(t,s){this.ctx=t,this.color=s.color||"white",this.size=s.size||5,this.count=s.count||10,this.duration=s.duration||1,this.particles=[],this.spawnParticles()}spawnParticles(s,e){for(let t=0;t<this.count;t++){var i=2*Math.random()*Math.PI,h=2*Math.random()+1;this.particles.push({x:s,y:e,vx:Math.cos(i)*h,vy:Math.sin(i)*h,size:this.size,life:Math.random()*this.duration,maxLife:this.duration})}}update(s){this.particles=this.particles.filter(t=>0<t.life),this.particles.forEach(t=>{t.x+=t.vx,t.y+=t.vy,t.life-=s})}draw(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.particles.forEach(t=>{this.ctx.fillStyle=this.color,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.size,0,2*Math.PI),this.ctx.fill()})}},s=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],z=44100,i={level:[],tint:{r:200,g:200,b:0},song:[[[,0,77,,,.7,2,.41,,,,,,,,.06],[,0,43,.01,,.3,2,,,,,,,,,.02,.01],[,0,170,.003,,.008,,.97,-35,53,,,,,,.1],[.8,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02],[,0,86,,,,,.7,,,,.5,,6.7,1,.05],[,0,41,,.05,.4,2,0,,,9,.01,,,,.08,.02],[,0,2200,,,.04,3,2,,,800,.02,,4.8,,.01,.1],[.3,0,16,,,.3,3]],[[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,24,,,,,,,,,,,,,,,,,,,,,,,,22,,22,,22,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,24,,,,,,,,27,,,,,,,,,,,,,,,,27,,,,24,,,,24,,,,,,,,27,,,,,,,,,,,,,,,,24,,24,,24,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[6,1,,,34,34,34,,,,,,34,34,,,,,34,,,,34,34,,,,,34,,,,34,,,,34,34,34,,,,,,34,,,,,,34,34,,,34,34,,,,,,,,,34,34],[4,1,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,23,23,35,23,23,36,23,23,35,23,23,36,23,23,35,35,23,23,35,23,23,35,23,23,36,23,23,35,23,23,36,36],[5,-1,21,,,19,,,21,,,,,,,,,,21,,,19,,,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,1,24,,,24,,,24,,,,,,,,,,24,,,24,,,24,,,,24.75,24.5,24.26,24.01,24.01,24.01,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[4,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,24.75,24.5,24.26,24.01,24.01,24.01,24.01,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,23,,21,23,,35,,23,,21,23,,35,,35,,23,,21,23,,35,,21,23,,35,,21,23,,,],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,36,34,,33,34,34,36,31,36,34,,31,34,32,,33,36,34,,31,34,34,36,33,36,33,,31,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,21,,19,21,,33,,21,,19,21,,33,,33,,21,,19,21,,33,,21,,19,21,,33,,33,,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29],[2,1,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,],[6,1,,,36,,,,,,36,,36,,,,,,,,36,,,,,,36,,36,,,,,,,,36,,,,,,,,,,,,,,,,36,,,,,,36,,36,,,,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,25,,,25,,,,,,,,25,,,,,,,,25,25,25,25]],[[1,-1,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,19,19,31,19,19,31,19,19,31,19,19,31,19,19,31,31],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,36,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,19,,19,19,31,19,19,31,19,,19,19,31,19,19,31],[2,1,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,,,,,,34,,34,,,,,,,,34,,,,,,34,,34,,,,,,]]],[0,1,1,2,3,4,4],,{title:"Depp",Notes:"Unknown author"}]},X={level:[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,[1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1],e,e,e,e,[1,1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1],e,e,s,s],tint:{r:255,g:0,b:0},song:[[[,0,77,,,.7,2,.41,,,,,,,,.06],[,0,43,.01,,.3,2,,,,,,,,,.02,.01],[,0,170,.003,,.008,,.97,-35,53,,,,,,.1],[.8,0,270,,,.12,3,1.65,-2,,,,,4.5,,.02],[,0,86,,,,,.7,,,,.5,,6.7,1,.05],[,0,41,,.05,.4,2,0,,,9,.01,,,,.08,.02],[,0,2200,,,.04,3,2,,,800,.02,,4.8,,.01,.1],[.3,0,16,,,.3,3]],[[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,24,,,,,,,,,,,,,,,,,,,,,,,,22,,22,,22,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33],[3,1,24,,,,,,,,27,,,,,,,,,,,,,,,,27,,,,24,,,,24,,,,,,,,27,,,,,,,,,,,,,,,,24,,24,,24,,,,],[5,-1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[,1,21,,,,,,,,,,,,,,,,,,,,,,,,,,,,24,,,,23,,,,,,,,,,,,,,,,,,,,,,,,24,,23,,21,,,,],[6,1,,,34,34,34,,,,,,34,34,,,,,34,,,,34,34,,,,,34,,,,34,,,,34,34,34,,,,,,34,,,,,,34,34,,,34,34,,,,,,,,,34,34],[4,1,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,,,,,,,24,,,,,,24,,24,,,,24,,,,24,,,,,,,,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,23,23,35,23,23,36,23,23,35,23,23,36,23,23,35,35,23,23,35,23,23,35,23,23,36,23,23,35,23,23,36,36],[5,-1,21,,,19,,,21,,,,,,,,,,21,,,19,,,17,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[3,1,24,,,24,,,24,,,,,,,,,,24,,,24,,,24,,,,24.75,24.5,24.26,24.01,24.01,24.01,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[4,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,24.75,24.5,24.26,24.01,24.01,24.01,24.01,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,23,,21,23,,35,,23,,21,23,,35,,35,,23,,21,23,,35,,21,23,,35,,21,23,,,],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,36,34,,33,34,34,36,31,36,34,,31,34,32,,33,36,34,,31,34,34,36,33,36,33,,31,,,]],[[1,-1,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,21,21,33,21,21,33,21,21,33,21,21,33,21,21,33,33,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,21,,19,21,,33,,21,,19,21,,33,,33,,21,,19,21,,33,,21,,19,21,,33,,33,,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29],[2,1,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,34,34,,34,,,],[6,1,,,36,,,,,,36,,36,,,,,,,,36,,,,,,36,,36,,,,,,,,36,,,,,,,,,,,,,,,,36,,,,,,36,,36,,,,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,25,,,25,,,,,,,,25,,,,,,,,25,25,25,25]],[[1,-1,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,14,14,26,14,14,26,14,14,26,14,14,26,14,14,26,26,17,17,29,17,17,29,17,17,29,17,17,29,17,17,29,29,19,19,31,19,19,31,19,19,31,19,19,31,19,19,31,31],[4,1,24,24,,24,24,,24,24,24,24,,24,24,,24,,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,24,24,24,24,,24,24,,36,,24,24,,24,24,,24,24,24,24,,24,24,,24,24],[7,-1,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,14,,14,14,26,14,14,26,17,,17,17,29,17,17,29,17,,17,17,29,17,17,29,19,,19,19,31,19,19,31,19,,19,19,31,19,19,31],[2,1,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,36,36,,36,,,],[3,1,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25,,,,,25,,,,,,,,25,,,,,,,,25,,,,,,,,25,25,25,25],[6,1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,34,,,,,,34,,34,,,,,,,,34,,,,,,34,,34,,,,,,]]],[0,1,1,2,3,4,4],,{title:"Depp",Notes:"Unknown author"}]},F=.3,q=new AudioContext,l=(t=1,s=.05,e=220,i=0,h=0,o=.1,n=0,P=1,a=0,r=0,l=0,c=0,d=0,H=0,u=0,W=0,y=0,b=1,g=0,m=0,p=0)=>{let v=Math,w=2*v.PI,x=44100,R=a*=500*w/x/x,f=e*=(1-s+2*s*v.random(s=[]))*w/x,k=0,G=0,L=0,T=1,Z=0,Y=0,S=0,A=p<0?-1:1,B=w*A*p*2/x,I=v.cos(B),C=v.sin,M=C(B)/4,E=1+M,V=-2*I/E,j=(1-M)/E,O=(1+A*I)/2/E,D=-(A+I)/E,U=O,X=0,z=0,K=0,J=0;for(r*=500*w/x**3,u*=w/x,l*=w/x,c*=x,d=x*d|0,t*=F,A=(i=x*i+9)+(g*=x)+(h*=x)+(o*=x)+(y*=x)|0;L<A;s[L++]=S*t)++Y%(100*W|0)||(S=n?1<n?2<n?3<n?C(k**3):v.max(v.min(v.tan(k),1),-1):1-(2*k/w%2+2)%2:1-4*v.abs(v.round(k/w)-k/w):C(k),S=(d?1-m+m*C(w*L/d):1)*(S<0?-1:1)*v.abs(S)**P*(L<i?L/i:L<i+g?1-(L-i)/g*(1-b):L<i+g+h?b:L<A-y?(A-L-y)/o*b:0),S=y?S/2+(y>L?0:(L<A-y?1:(A-L)/y)*s[L-y|0]/2/t):S,p&&(S=J=U*X+D*(X=z)+O*(z=S)-j*K-V*(K=J))),B=(e+=a+=r)*v.cos(u*G++),k+=B+B*H*C(L**5),T&&++T>c&&(e+=l,f+=l,T=0),!d||++Z%d||(e=f,a=R,T=T||1);(t=q.createBuffer(1,A,x)).getChannelData(0).set(s),(e=q.createBufferSource()).buffer=t,e.connect(q.destination),e.start()},h=class{constructor(t,s,e,i,h,o){this.speed=h,this.distance=-.1,this.text=t,this.x=s,this.y=e,this.size=i,this.AmFlickering=o,this.flicking=0}startTyping(){this.distance+=this.speed/100}draw(){var e=b.ctx,i=new Image;i.src="./WhiteFont.png";for(let s=0;s<this.text.length&&!(s>this.distance);s++){var h=this.text[s].toLowerCase();let t=0;null!==o(h)&&(t=o(h));this.AmFlickering?(this.flicking+=.1,10<this.flicking&&(e.drawImage(i,5*t-5-.1,0,5,5,this.x+s*this.size,this.y+3,this.size,this.size),setTimeout(()=>{this.flicking=0},1e3))):e.drawImage(i,5*t-5-.1,0,5,5,this.x+s*this.size,this.y+3,this.size,this.size)}}};function o(t){return"a"<=t&&t<="z"?t.charCodeAt(0)-"a".charCodeAt(0)+1:"0"<=t&&t<="9"?t.charCodeAt(0)-"0".charCodeAt(0)+27:null}var K=class{constructor(t,s,e,i){this.visible=!0,this.speed=t,this.x=e,this.y=i,this.w=5,this.h=5,this.directionX=s}update(t){t.fillStyle="white",t.fillRect(this.x,this.y,this.w,this.h),this.x+=this.directionX*this.speed}},n=class{constructor(t,s,e,i){this.timeLeft=0,this.gunSpeed=10,this.direction=t,this.pos=new u(s,e),this.width=40,this.height=10,this.angle=10,this.directionX=0,this.player=i,this.damage=15}shoot(){0<this.player.bulletsLeft?this.timeLeft<=0&&(--this.player.bulletsLeft,l(2.04,void 0,475,.01,.03,.06,4,1.9,-8.7,void 0,void 0,void 0,.09,void 0,36,.2,.17,.67,.04),this.directionX=Math.cos(this.angle),this.directionY=Math.sin(this.angle),b.bullets.push(new K(this.gunSpeed,this.directionX,this.pos.x,this.pos.y)),this.timeLeft=10):"intro"!==b.currentScreen&&(this.player.grow(),setTimeout(()=>{b.PlayerToBig=!0},5e3))}update(t,s,e){this.pos.x=s,this.pos.y=e,this.directionX=t,this.timeLeft-=.5,0<t?this.angle=0:t<0&&(this.angle=Math.PI)}},P=class{constructor(t,s,e){this.bounds=new r(t,s,b.BLOCKSIZE,b.BLOCKSIZE),this.tileSet=new Image,this.tileSet.src="./Tileset.png",this.WHATBlockAmI=e}draw(t,s,e,i){1==this.WHATBlockAmI&&(t.drawImage(this.tileSet,32,8,8,8,this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h),t.save(),t.globalCompositeOperation="source-atop",t.fillStyle="rgba("+s+", "+e+", "+i+", 0.5)",t.fillRect(this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h),t.restore())}},e=class{constructor(t,s,e,i){this.width,this.height,this.blocks=t,this.level=s,this.x=1,this.y=1,this.options=e,this.id=i}get(t){var s,e=t.x,i=t.y;for(s of this.blocks)if(s.bounds.x===e*b.BLOCKSIZE&&s.bounds.y===i*b.BLOCKSIZE)return s;return null}init(){console.log("Level is",this.id),this.height=this.level.length,this.width=this.level[0].length;for(let s=0;s<this.level.length;s++)for(let t=0;t<this.level[s].length;t++){var e=this.level[s][t];this.x=t,this.y=s,this.blocks.push(new P(this.x*b.BLOCKSIZE,this.y*b.BLOCKSIZE,e))}}},y=class{constructor(t,s){this.bounds=new r(1e3*Math.random()+100,500,40,40),this.gravity=.27,this.Yvelocity=0,this.Xvelocity=0,this.speed=.75,this.jumpHeight=3,this.grounded=!1,this.player=t,this.sprite=new Image,this.sprite.src=s,this.alive=!0}update(t){this.alive||b.enemys.splice(b.enemys.indexOf(this),1);for(let t=0;t<b.bullets.length;t++){var s=new r(b.bullets[t].x,b.bullets[t].y,b.bullets[t].w,b.bullets[t].h);(s.intersects(this.bounds)||this.bounds.intersects(s))&&(b.bullets.splice(t,1),this.alive=!1,--b.mobsLeft)}this.bounds.y+=this.Yvelocity,this.bounds.x+=this.Xvelocity;var e=Math.floor(this.bounds.x/b.BLOCKSIZE),i=Math.floor(this.bounds.y/b.BLOCKSIZE),e=new u(e,i),i=(t.get(e),t.get(e.add(1,0))),h=t.get(e.add(1,1)),o=t.get(e.add(0,0)),n=t.get(e.add(0,1)),a=t.get(e.add(0,1)),t=t.get(e.add(1,1));1==i.WHATBlockAmI&&1==h.WHATBlockAmI?(this.bounds.x=e.x*b.BLOCKSIZE,this.Xvelocity=0,this.isGrounded=1==a.WHATBlockAmI):1==o.WHATBlockAmI&&1==n.WHATBlockAmI?(this.bounds.x=(e.x+1)*b.BLOCKSIZE,this.Xvelocity=0,this.isGrounded=1==t.WHATBlockAmI):this.isGrounded=1==a.WHATBlockAmI||1==t.WHATBlockAmI,this.isGrounded?(this.grounded=!0,this.Yvelocity=0,this.ableToJump=!0,this.bounds.y=e.y*b.BLOCKSIZE):(this.grounded=!1,this.applyGravity()),this.followPlayer(),this.bounds.y>this.player.bounds.y&&this.jump()}followPlayer(){this.player.bounds.x>this.bounds.x?this.Xvelocity=this.speed+(5*Math.random()-2.5):this.Xvelocity=-this.speed+(5*Math.random()-2.5)}applyGravity(){this.Yvelocity+=this.gravity}jump(){this.grounded&&(this.Yvelocity-=this.jumpHeight,this.grounded=!1)}draw(){var t;1==b.debug&&(b.ctx.strokeStyle="red",b.ctx.strokeRect(this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h)),this.Xvelocity<0?b.ctx.drawImage(this.sprite,this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h):(b.ctx.save(),b.ctx.scale(-1,1),t=-this.bounds.x-this.bounds.w,b.ctx.drawImage(this.sprite,t,this.bounds.y,this.bounds.w,this.bounds.h),b.ctx.restore())}};var H=class{constructor(t){this.actionWeights=t,this.actions=Object.keys(t),this.timer=10}update(s){this.timer+=.1;e=s.characterPosition,h=s.playerPosition,t=e.x+e.width/2,t=h.x+h.width/2-t,h=h.y+h.height/2-(e.y+e.height/2);var t,e=Math.sqrt(t*t+h*h),i=(s.position=e<25?"closeToEnemy":"farFromEnemy",s.gameState=50<(t=s.health)?"safe":25<t?"warning":"risky",this.actions.map(t=>((t,s)=>{let e=0;switch(t){case"attack":50<s.health&&(e+=5,"closeToEnemy"===s.position)&&(e+=10);break;case"defend":s.health<50&&(e+=10);break;case"run":s.health<30&&(e+=15,"closeToEnemy"===s.position)&&(e+=5);break;case"idle":e=1;break;default:console.warn("Unknown action: "+t)}return Math.max(0,e)})(t,s)*(this.actionWeights[t]||1))),h=i.reduce((t,s)=>t+s,0);if(0===h)return this.actions[0];var o=Math.random()*h;let n=0;for(let t=0;t<this.actions.length;t++)if(o<(n+=i[t])&&15<this.timer)return this.timer=0,this.actions[t]}};var s=class{constructor(t,s,e){this.bounds=new r(200,150,100,100),this.speed=1,this.actions=e,this.Velocity=new u(0,0),this.gravity=.2,this.image=new Image,this.image.src="./BabyDuck.png",this.factors={health:t,characterPosition:this.bounds,playerPosition:s.bounds,position:"",gameState:""},this.ableToAttack=!1,setTimeout(()=>{this.ableToAttack=!0},3e3),this.ai=new H(this.actions),this.player=s,this.alive=!0,this.isGrounded=!1,this.currentAction=null}knockBack(){0<this.Velocity.x?this.bounds.x-=50*this.speed:this.bounds.x+=50*this.speed}draw(){this.alive&&b.ctx.drawImage(this.image,this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h)}update(e){if(this.ableToAttack&&(t=this.player,"chicken"!=(s=(s="baby duck").toLowerCase())&&"duck"!=s||(b.enemys.push(new y(t,"./Duck.png")),b.mobsLeft+=1),"baby chicken"!=s&&"baby duck"!=s||(b.enemys.push(new y(t,"./BabyDuck.png")),b.mobsLeft+=1),this.ableToAttack=!1,s=1e4-100*b.timePlayed,s=Math.max(s,1e3),setTimeout(()=>{this.ableToAttack=!0},s)),this.factors.health<=0)this.alive=!1;else if(this.alive){this.bounds.x+=this.Velocity.x,this.Velocity.x>this.speed&&(this.Velocity.x=this.speed-.1),this.Velocity.x<-this.speed&&(this.Velocity.x=.1-this.speed);var t=Math.floor((this.bounds.x+this.bounds.w/2)/b.BLOCKSIZE),s=Math.floor(this.bounds.y/b.BLOCKSIZE),i=new u(t,s),h=e.get(i.add(1,0)),o=e.get(i.add(1,1)),n=e.get(i.add(0,0)),a=e.get(i.add(0,1)),r=[],l=Math.floor(this.bounds.h/(b.BLOCKSIZE-5)),c=Math.floor(this.bounds.w/(b.BLOCKSIZE-5));for(let s=0;s<l;s++)for(let t=0;t<c;t++)r.push(e.get(i.add(t-1,s+1)));for(let t=0;t<r.length;t++)b.debugBlocks.push(r[t]);if(this.isGrounded=!1,h&&1===h.WHATBlockAmI&&o&&1===o.WHATBlockAmI)this.bounds.x=(i.x-2)*b.BLOCKSIZE,this.Velocity.x=0;else if(n&&1===n.WHATBlockAmI&&a&&1===a.WHATBlockAmI)this.bounds.x=(i.x+1)*b.BLOCKSIZE,this.Velocity.x=0;else for(var d of r)0!==d.WHATBlockAmI&&(this.isGrounded=!0);this.currentAction&&this.currentAction(),this.isGrounded?(this.bounds.y=Math.floor(this.bounds.y/b.BLOCKSIZE)*b.BLOCKSIZE,this.Velocity.y=0,this.ableToJump=!0):this.applyGravity(),this.factors.characterPosition=this.bounds,this.factors.playerPosition=this.player.bounds;h=this.ai.update(this.factors);"attack"===h?this.currentAction=this.attack:"defend"===h?this.currentAction=this.defend:"run"===h?this.currentAction=this.runAway:"idle"===h&&(this.currentAction=this.idle),this.collision()}}hit(t){this.factors.health-=t,this.knockBack(),--b.mobsLeft}collision(){for(let t=0;t<b.bullets.length;t++){var s=new r(b.bullets[t].x,b.bullets[t].y,b.bullets[t].w,b.bullets[t].h);(this.bounds.intersects(s)||s.intersects(this.bounds))&&(this.hit(this.player.gun.damage),b.bullets.splice(t,1))}}applyGravity(){this.Velocity.y+=this.gravity,this.bounds.y+=this.Velocity.y}attack(){this.player.bounds.x>this.bounds.x?this.Velocity.x+=this.speed:this.Velocity.x-=this.speed}defend(){console.log("Defend")}runAway(){console.log("Run away"),this.bounds.x>this.player.bounds.x?this.Velocity.x+=this.speed:this.Velocity.x-=this.speed}idle(){console.log("Do nothing")}},b=new class{constructor(){this.boss=[],this.currentKey=new Map,this.mobsLeft=0,this.blocks=[],this.SCROLLX=200,this.debug=!0,this.SCROLLY=0,this.canvas=document.getElementById("canvas"),this.ctx=this.canvas.getContext("2d"),this.bullets=[],this.mouseClicked=!1,this.debugBlocks=[],this.enemys=[],this.mouseX=0,this.mouseY=0,this.PlayerToBig=!1,this.BLOCKSIZE=32,this.currentScreen="splash",this.type_distance=0,this.flicking=0,this.currentUrl=window.location.href,this.baseUrl=new URL(this.currentUrl).origin,this.timePlayed=0,this.navKey=new Map,this.currentLevel=null,this.particleEngine=new t(this.ctx,{color:"red",size:3,count:100,duration:.5}),this.GameLevel1Options=i,this.IntroOptions=X,this.zzfx=(...t)=>this.zzfxP(this.zzfxG(...t)),this.zzfxP=(...t)=>{let s=q.createBufferSource(),e=q.createBuffer(t.length,t[0].length,z);return t.map((t,s)=>e.getChannelData(s).set(t)),s.buffer=e,s.connect(q.destination),s.start(),s},this.zzfxG=(t=1,s=.05,e=220,i=0,h=0,o=.1,n=0,a=1,r=0,l=0,c=0,d=0,u=0,y=0,b=0,g=0,m=0,p=1,v=0,w=0)=>{let x=2*Math.PI,f=r*=500*x/z**2,k=(0<b?1:-1)*x/4,L=e*=(1+2*s*Math.random()-s)*x/z,T=[],S=0,A=0,B=0,I=1,C=0,M=0,E=0,O,X;for(l*=500*x/z**3,b*=x/z,c*=x/z,d*=z,u=z*u|0,X=(i=99+z*i)+(v*=z)+(h*=z)+(o*=z)+(m*=z)|0;B<X;T[B++]=E)++M%(100*g|0)||(E=n?1<n?2<n?3<n?Math.sin((S%x)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/x%2+2)%2:1-4*Math.abs(Math.round(S/x)-S/x):Math.sin(S),E=(u?1-w+w*Math.sin(2*Math.PI*B/u):1)*(0<E?1:-1)*Math.abs(E)**a*t*F*(B<i?B/i:B<i+v?1-(B-i)/v*(1-p):B<i+v+h?p:B<X-m?(X-B-m)/o*p:0),E=m?E/2+(m>B?0:(B<X-m?1:(X-B)/m)*T[B-m|0]/2):E),O=(e+=r+=l)*Math.sin(A*b-k),S+=O-O*y*(1-1e9*(Math.sin(B)+1)%2),A+=O-O*y*(1-1e9*(Math.sin(B)**2+1)%2),I&&++I>d&&(e+=c,L+=c,I=0),!u||++C%u||(e=L,r=f,I=I||1);return T},this.zzfxV=.3,this.zzfxX=new(window.AudioContext||webkitAudioContext),this.zzfxM=(e,i,h,t=125)=>{let o,n,a,r,l,c,d,u,y,b,g,m,p,v,w=0,x=[],f=[],k=[],L=0,T=0,S=1,A={},B=z/t*60>>2;for(;S;L++)x=[S=u=m=0],h.map((t,s)=>{for(d=i[t][L]||[0,0,0],S|=!!i[t][L],v=m+(i[t][0].length-2-!u)*B,p=s==h.length-1,n=2,r=m;n<d.length+p;u=++n){for(l=d[n],y=n==d.length+p-1&&p||b!=(d[0]||0)|l|0,a=0;a<B&&u;a++>B-99&&y&&(g+=(g<1)/99))c=(1-g)*x[w++]/2||0,f[r]=(f[r]||0)-c*T+c,k[r]=(k[r++]||0)+c*T+c;l&&(g=l%1,T=d[1]||0,l|=0)&&(x=A[[b=d[w=0]||0,l]]=A[[b,l]]||((o=[...e[b]])[2]*=2**((l-12)/12),0<l?this.zzfxG(...o):[]))}m=v});return[f,k]}}reset(){location.reload()}},a=new class{constructor(){this.bounds=new r(700,500,30,30),this.animator=new u(0,0),this.gravity=.27,this.Yvelocity=0,this.Xvelocity=0,this.speed=2,this.friction=.75,this.jumpHeight=5,this.grounded=!1,this.timeLeft=0,this.maxSpeed=2,this.isGrounded=!1,this.ableToJump=!1,this.gun=new n(this.Xvelocity,this.bounds.x,this.bounds.y,this),this.image=new Image,this.image.src="../Assets/Player-Sheet.png",this.frameRate=60,this.frames=0,this.health=3,this.bulletsLeft=13,this.moveable=!0,this.bulletsText=new h("Bullets - ",75+b.SCROLLX,75,25,500,!1)}reset(){this.bounds=new r(700,500,30,30),this.animator=new u(0,0),this.gravity=.27,this.Yvelocity=0,this.Xvelocity=0,this.speed=2,this.friction=.75,this.jumpHeight=5,this.grounded=!1,this.timeLeft=0,this.maxSpeed=2,this.isGrounded=!1,this.ableToJump=!1,this.gun=new n(this.Xvelocity,this.bounds.x,this.bounds.y,this),this.image=new Image,this.image.src="../Assets/Player-Sheet.png",this.frameRate=60,this.frames=0,this.health=3,this.bulletsLeft=13,this.moveable=!0,this.bulletsText=new h("Bullets - ",75+b.SCROLLX,10,25,500,!1),console.log("RESET",this.gravity,this.Xvelocity,this.Yvelocity)}grow(){this.moveable=!1,this.bounds.x=700-this.bounds.w/2,this.bounds.y=500-this.bounds.h/2,this.bounds.w+=.12,this.bounds.h+=.12,setTimeout(()=>{this.bulletsLeft<13&&this.grow()},75)}draw(t){var s;0!==Math.round(this.Xvelocity)&&this.animate(),t.save(),b.ctx.filter=`grayscale(${100-7.69*this.bulletsLeft}%)`,this.gun.update(this.Xvelocity,this.bounds.x,this.bounds.y+12),t.fillStyle="red",0<this.Xvelocity?t.drawImage(this.image,this.animator.x,this.animator.y,16,16,this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h):(t.save(),t.scale(-1,1),s=-this.bounds.x-this.bounds.w,t.drawImage(this.image,this.animator.x,this.animator.y,16,16,s,this.bounds.y,this.bounds.w,this.bounds.h),t.restore()),b.debug&&(t.strokeStyle="yellow",t.lineWidth=2,t.strokeRect(this.bounds.x,this.bounds.y,this.bounds.w,this.bounds.h)),t.restore(),t.fillStyle="red",t.fillRect(75+b.SCROLLX,50,50*this.health,20),t.strokeStyle="white",t.lineWidth=4,t.strokeRect(75+b.SCROLLX,50,150,20),this.bulletsText.x=75+b.SCROLLX,this.bulletsText.text="Bullets "+this.bulletsLeft,this.bulletsText.draw(),this.bulletsText.startTyping()}animate(){this.frames+=this.frameRate,500<this.frames?(this.animator.x=16,1e3<this.frames&&(this.frames=0)):this.animator.x=0}knockback(t){Math.round(t),this.Xvelocity+=30*this.speed,this.jump(10)}jump(t){var s=this.jumpHeight;t&&(this.jumpHeight=t),this.Yvelocity=-this.jumpHeight-2,this.grounded=!1,this.bounds.y-=5,this.jumpHeight=s}collision(){for(let t=0;t<b.enemys.length;t++)(this.bounds.intersects(b.enemys[t].bounds)||b.enemys[t].bounds.intersects(this.bounds))&&(this.health-=.25,l(1.98,void 0,523,.01,.01,.07,2,1.9,-8.7,void 0,void 0,void 0,.09,void 0,36,.2,.17,.67,.04),this.knockback(this.Xvelocity)),(this.bounds.intersects(b.boss.bounds)||b.boss.bounds.intersects(this.bounds))&&(this.health-=.25,l(1.98,void 0,523,.01,.01,.07,2,1.9,-8.7,void 0,void 0,void 0,.09,void 0,36,.2,.17,.67,.04),this.knockback(this.Xvelocity))}update(t,s){this.timeLeft-=.5,this.Xvelocity*=this.friction,this.Xvelocity>this.maxSpeed&&(this.Xvelocity=this.maxSpeed),this.Xvelocity<-this.maxSpeed&&(this.Xvelocity=-this.maxSpeed);var e=Math.floor(this.bounds.x/b.BLOCKSIZE),i=Math.floor(this.bounds.y/b.BLOCKSIZE),e=new u(e,i),i=s.get(e.add(1,0)),h=s.get(e.add(1,1)),o=s.get(e.add(0,0)),n=s.get(e.add(0,1)),a=s.get(e.add(0,1)),s=s.get(e.add(1,1));b.debugBlocks.push(i),b.debugBlocks.push(h),b.debugBlocks.push(o),b.debugBlocks.push(n),b.debugBlocks.push(a),b.debugBlocks.push(s),1==i.WHATBlockAmI&&1==h.WHATBlockAmI?(this.bounds.x=e.x*b.BLOCKSIZE,this.Xvelocity=0,this.isGrounded=1==a.WHATBlockAmI):1==o.WHATBlockAmI&&1==n.WHATBlockAmI?(this.bounds.x=(e.x+1)*b.BLOCKSIZE,this.Xvelocity=0,this.isGrounded=1==s.WHATBlockAmI):this.isGrounded=1==a.WHATBlockAmI||1==s.WHATBlockAmI,this.isGrounded?(this.grounded=!0,this.Yvelocity=0,this.ableToJump=!0,this.bounds.y=e.y*b.BLOCKSIZE):(this.grounded=!1,this.moveable&&this.applyGravity()),(b.mouseClicked||b.currentKey.get("e"))&&this.gun.shoot(),this.moveable&&this.handleMovement(t),this.bounds.x+=this.Xvelocity,this.collision(),this.health<=0&&(l(2,void 0,727,.01,.03,.53,3,1.39,.9,.1,void 0,void 0,void 0,1.9,-44,.4,.39,.31,.12),alert("You died"),setTimeout(()=>{location.reload()},1e3))}handleMovement(t){(t.get("a")||t.get("ArrowLeft"))&&(this.Xvelocity-=this.speed),(t.get("d")||t.get("ArrowRight"))&&(this.Xvelocity+=this.speed),(t.get(" ")||t.get("ArrowUp")||t.get("w"))&&this.ableToJump&&this.grounded&&this.jump()}applyGravity(){this.Yvelocity+=this.gravity,this.bounds.y+=this.Yvelocity}},c=new s(100,a,{attack:15,defend:10,run:5,idle:4}),d=(b.boss=c,b.mobsLeft+=1,b.canvas.addEventListener("mousedown",t=>{b.mouseClicked=!0}),b.canvas.addEventListener("mouseup",t=>{b.mouseClicked=!1}),b.canvas.addEventListener("mousemove",t=>{b.mouseX=t.clientX,b.mouseY=t.clientY}),new e(b.blocks,b.IntroOptions.level,b.IntroOptions,"intro")),g=new e(b.blocks,b.GameLevel1Options.level,b.GameLevel1Options,"level1"),m=(console.log(b.IntroOptions),new h("The 13th Challenge",b.canvas.width/6,b.canvas.height/2-50,75,10,!1)),p=new h("JS13K by a 15 year old",b.canvas.width/4.5,b.canvas.height/2+50,50,5,!1),v=new h("Press Enter to start",b.canvas.width/3.25,b.canvas.height/2+125,35,5,!0),w=new h("As the last bullet fires and the weapon falls silent",400,100,20,15,!1),x=new h("an overwhelming dread engulfs him",600,125,20,15,!1),f=new h("and he feels himself growing larger",585,150,20,15,!1);var k=0,L=new h("This is your player",415,200,20,20,!1),T=new h("Use W A S D or The Arrow Keys",325,200,20,20,!1),S=new h("to run around and jump",400,230,20,20,!1),A=new h("You have a phobia about running out of bullets",200,200,20,20,!1),B=new h("You only have 13 left ....",400,230,20,20,!1),I=new h("Click to shoot a bullet",375,400,20,20,!1),C=new h("Whatever you do dont run out of bullets",280,400,20,20,!1),M=new h("Press Enter to skip",10,10,15,500,!0);function E(){if(b.debugBlocks=[],b.ctx.fillStyle="black",b.ctx.imageSmoothingEnabled=!1,b.ctx.clearRect(0,0,b.canvas.width,b.canvas.height),"splash"==b.currentScreen&&(m.draw(),p.draw(),v.draw(),m.startTyping(),p.startTyping(),v.startTyping(),b.currentKey.get("Enter"))&&setTimeout(()=>{b.currentScreen="intro",d.init()},10),"intro"==b.currentScreen){var t;b.ctx.save(),b.ctx.scale(1.25,1.25),b.ctx.translate(-b.SCROLLX,-b.SCROLLY),b.currentLevel=d,M.draw(),M.startTyping(),setTimeout(()=>{var t;b.currentKey.get("Enter")&&(a.reset(),b.currentScreen="game",b.currentLevel=g,t=b.currentLevel.options.song,t=b.zzfxM(...t),b.zzfxP(...t),k=null)},1e3),0===k&&(A.draw(),A.startTyping(),B.draw(),B.startTyping(),setTimeout(()=>{k=1},5e3)),1===k&&(L.draw(),L.startTyping(),setTimeout(()=>{k=2},5e3)),2===k&&(T.draw(),T.startTyping(),S.draw(),S.startTyping(),setTimeout(()=>{k=3},5e3)),3===k&&(I.draw(),I.startTyping(),setTimeout(()=>{k=4},5e3)),4===k&&(C.draw(),C.startTyping(),setTimeout(()=>{k=5},7500)),5==k&&(a.reset(),b.currentScreen="game",b.currentLevel=g,t=b.currentLevel.options.song,t=b.zzfxM(...t),b.zzfxP(...t),k=null);for(let t=0;t<b.blocks.length;t++)b.blocks[t].draw(b.ctx,b.currentLevel.options.tint.r,b.currentLevel.options.tint.g,b.currentLevel.options.tint.b);a.draw(b.ctx),b.bullets.forEach(t=>{t.update(b.ctx)}),a.update(b.currentKey,b.currentLevel),b.SCROLLX=(a.bounds.x-b.canvas.width/2)/1.4,b.ctx.restore()}if("big"===b.currentScreen&&(w.draw(),x.draw(),f.draw(),w.startTyping(),setTimeout(()=>{x.startTyping(),setTimeout(()=>{f.startTyping()},3500)},6e3)),"game"==b.currentScreen){if(b.timePlayed+=.05,b.ctx.save(),b.ctx.scale(1.25,1.25),b.ctx.translate(-b.SCROLLX,-b.SCROLLY),b.particleEngine.update(.01),a.update(b.currentKey,b.currentLevel),c.update(b.currentLevel),b.particleEngine.draw(),b.bullets.forEach(t=>{t.update(b.ctx)}),1==b.debug)for(let t=0;t<b.debugBlocks.length;t++)b.ctx.lineWidth=5,b.ctx.strokeStyle="red",4==t&&(b.ctx.strokeStyle="blue"),5==t&&(b.ctx.strokeStyle="green"),b.ctx.strokeRect(b.debugBlocks[t].bounds.x,b.debugBlocks[t].bounds.y,b.debugBlocks[t].bounds.w,b.debugBlocks[t].bounds.h);for(let t=0;t<b.blocks.length;t++)b.blocks[t].draw(b.ctx,b.currentLevel.options.tint.r,b.currentLevel.options.tint.g,b.currentLevel.options.tint.b);a.draw(b.ctx,b.particleEngine);for(let t=0;t<b.enemys.length;t++)b.enemys[t].draw(),b.enemys[t].update(b.currentLevel);b.PlayerToBig&&(b.currentScreen="big"),b.PlayerToBig||new h(b.currentLevel.id,350,200,75,500,!1).draw(),c.draw(),b.SCROLLX=(a.bounds.x-b.canvas.width/2)/1.4,b.ctx.restore()}console.log(b.mobsLeft),b.mobsLeft,b.navKey.clear(),requestAnimationFrame(E)}window.addEventListener("keydown",t=>{b.currentKey.set(t.key,!0),b.navKey.set(t.key,!0)}),window.addEventListener("keyup",t=>{b.currentKey.set(t.key,!1),b.navKey.set(t.key,!1)}),E()})();